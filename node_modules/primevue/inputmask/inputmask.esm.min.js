import{DomHandler as t}from"primevue/utils";import e from"primevue/basecomponent";import i from"primevue/inputmask/style";import{openBlock as s,createElementBlock as n,mergeProps as a}from"vue";var h={name:"InputMask",extends:{name:"BaseInputMask",extends:e,props:{modelValue:null,slotChar:{type:String,default:"_"},mask:{type:String,default:null},autoClear:{type:Boolean,default:!0},unmask:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},invalid:{type:Boolean,default:!1},variant:{type:String,default:null}},style:i},inheritAttrs:!1,emits:["update:modelValue","focus","blur","keydown","complete","keypress","paste"],watch:{mask:function(t,e){e!==t&&this.initMask()}},mounted:function(){this.initMask()},updated:function(){this.isValueUpdated()&&this.updateValue()},methods:{onInput:function(t){this.androidChrome?this.handleAndroidInput(t):this.handleInputChange(t),this.$emit("update:modelValue",t.target.value)},onFocus:function(t){var e,i=this;this.readonly||(this.focus=!0,clearTimeout(this.caretTimeoutId),this.focusText=this.$el.value,e=this.checkVal(),this.caretTimeoutId=setTimeout((function(){i.$el===document.activeElement&&(i.writeBuffer(),e===i.mask.replace("?","").length?i.caret(0,e):i.caret(e))}),10),this.$emit("focus",t))},onBlur:function(t){if(this.focus=!1,this.checkVal(),this.updateModel(t),this.$el.value!==this.focusText){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.$el.dispatchEvent(e)}this.$emit("blur",t)},onKeyDown:function(e){if(!this.readonly){var i,s,n,a=e.which||e.keyCode,h=/iphone/i.test(t.getUserAgent());this.oldVal=this.$el.value,8===a||46===a||h&&127===a?((n=(i=this.caret()).end)-(s=i.begin)==0&&(s=46!==a?this.seekPrev(s):n=this.seekNext(s-1),n=46===a?this.seekNext(n):n),this.clearBuffer(s,n),this.shiftL(s,n-1),this.updateModel(e),e.preventDefault()):13===a?(this.$el.blur(),this.updateModel(e)):27===a&&(this.$el.value=this.focusText,this.caret(0,this.checkVal()),this.updateModel(e),e.preventDefault()),this.$emit("keydown",e)}},onKeyPress:function(e){var i=this;if(!this.readonly){var s,n,a,h,l=e.which||e.keyCode,r=this.caret();if(!(e.ctrlKey||e.altKey||e.metaKey||l<32)){if(l&&13!==l){if(r.end-r.begin!=0&&(this.clearBuffer(r.begin,r.end),this.shiftL(r.begin,r.end-1)),(s=this.seekNext(r.begin-1))<this.len&&(n=String.fromCharCode(l),this.tests[s].test(n))){if(this.shiftR(s),this.buffer[s]=n,this.writeBuffer(),a=this.seekNext(s),/android/i.test(t.getUserAgent())){setTimeout((function(){i.caret(a)}),0)}else this.caret(a);r.begin<=this.lastRequiredNonMaskPos&&(h=this.isCompleted())}e.preventDefault()}this.updateModel(e),h&&this.$emit("complete",e),this.$emit("keypress",e)}}},onPaste:function(t){this.handleInputChange(t),this.$emit("paste",t)},caret:function(t,e){var i,s,n;if(this.$el.offsetParent&&this.$el===document.activeElement)return"number"!=typeof t?(this.$el.setSelectionRange?(s=this.$el.selectionStart,n=this.$el.selectionEnd):document.selection&&document.selection.createRange&&(n=(s=0-(i=document.selection.createRange()).duplicate().moveStart("character",-1e5))+i.text.length),{begin:s,end:n}):(s=t,n="number"==typeof e?e:s,void(this.$el.setSelectionRange?this.$el.setSelectionRange(s,n):this.$el.createTextRange&&((i=this.$el.createTextRange()).collapse(!0),i.moveEnd("character",n),i.moveStart("character",s),i.select())))},isCompleted:function(){for(var t=this.firstNonMaskPos;t<=this.lastRequiredNonMaskPos;t++)if(this.tests[t]&&this.buffer[t]===this.getPlaceholder(t))return!1;return!0},getPlaceholder:function(t){return this.slotChar.charAt(t<this.slotChar.length?t:0)},seekNext:function(t){for(;++t<this.len&&!this.tests[t];);return t},seekPrev:function(t){for(;--t>=0&&!this.tests[t];);return t},shiftL:function(t,e){var i,s;if(!(t<0)){for(i=t,s=this.seekNext(e);i<this.len;i++)if(this.tests[i]){if(!(s<this.len&&this.tests[i].test(this.buffer[s])))break;this.buffer[i]=this.buffer[s],this.buffer[s]=this.getPlaceholder(s),s=this.seekNext(s)}this.writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,t))}},shiftR:function(t){var e,i,s,n;for(e=t,i=this.getPlaceholder(t);e<this.len;e++)if(this.tests[e]){if(s=this.seekNext(e),n=this.buffer[e],this.buffer[e]=i,!(s<this.len&&this.tests[s].test(n)))break;i=n}},handleAndroidInput:function(t){var e=this.$el.value,i=this.caret();if(this.oldVal&&this.oldVal.length&&this.oldVal.length>e.length){for(this.checkVal(!0);i.begin>0&&!this.tests[i.begin-1];)i.begin--;if(0===i.begin)for(;i.begin<this.firstNonMaskPos&&!this.tests[i.begin];)i.begin++;this.caret(i.begin,i.begin)}else{for(this.checkVal(!0);i.begin<this.len&&!this.tests[i.begin];)i.begin++;this.caret(i.begin,i.begin)}this.isCompleted()&&this.$emit("complete",t)},clearBuffer:function(t,e){var i;for(i=t;i<e&&i<this.len;i++)this.tests[i]&&(this.buffer[i]=this.getPlaceholder(i))},writeBuffer:function(){this.$el.value=this.buffer.join("")},checkVal:function(t){this.isValueChecked=!0;var e,i,s,n=this.$el.value,a=-1;for(e=0,s=0;e<this.len;e++)if(this.tests[e]){for(this.buffer[e]=this.getPlaceholder(e);s++<n.length;)if(i=n.charAt(s-1),this.tests[e].test(i)){this.buffer[e]=i,a=e;break}if(s>n.length){this.clearBuffer(e+1,this.len);break}}else this.buffer[e]===n.charAt(s)&&s++,e<this.partialPosition&&(a=e);return t?this.writeBuffer():a+1<this.partialPosition?this.autoClear||this.buffer.join("")===this.defaultBuffer?(this.$el.value&&(this.$el.value=""),this.clearBuffer(0,this.len)):this.writeBuffer():(this.writeBuffer(),this.$el.value=this.$el.value.substring(0,a+1)),this.partialPosition?e:this.firstNonMaskPos},handleInputChange:function(t){if(!this.readonly&&!("paste"===t.type)){var e=this.checkVal(!0);this.caret(e),this.updateModel(t),this.isCompleted()&&this.$emit("complete",t)}},getUnmaskedValue:function(){for(var t=[],e=0;e<this.buffer.length;e++){var i=this.buffer[e];this.tests[e]&&i!==this.getPlaceholder(e)&&t.push(i)}return t.join("")},updateModel:function(t){var e=this.unmask?this.getUnmaskedValue():t.target.value;this.$emit("update:modelValue",this.defaultBuffer!==e?e:"")},updateValue:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$el&&(null==this.modelValue?(this.$el.value="",e&&this.$emit("update:modelValue","")):(this.$el.value=this.modelValue,this.checkVal(),setTimeout((function(){if(t.$el&&(t.writeBuffer(),t.checkVal(),e)){var i=t.unmask?t.getUnmaskedValue():t.$el.value;t.$emit("update:modelValue",t.defaultBuffer!==i?i:"")}}),10)),this.focusText=this.$el.value)},initMask:function(){this.tests=[],this.partialPosition=this.mask.length,this.len=this.mask.length,this.firstNonMaskPos=null,this.defs={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"};var e=t.getUserAgent();this.androidChrome=/chrome/i.test(e)&&/android/i.test(e);for(var i=this.mask.split(""),s=0;s<i.length;s++){var n=i[s];"?"===n?(this.len--,this.partialPosition=s):this.defs[n]?(this.tests.push(new RegExp(this.defs[n])),null===this.firstNonMaskPos&&(this.firstNonMaskPos=this.tests.length-1),s<this.partialPosition&&(this.lastRequiredNonMaskPos=this.tests.length-1)):this.tests.push(null)}this.buffer=[];for(var a=0;a<i.length;a++){var h=i[a];"?"!==h&&this.buffer.push(this.defs[h]?this.getPlaceholder(a):h)}this.defaultBuffer=this.buffer.join(""),this.updateValue(!1)},isValueUpdated:function(){return this.unmask?this.modelValue!=this.getUnmaskedValue():this.defaultBuffer!==this.$el.value&&this.$el.value!==this.modelValue}},computed:{filled:function(){return null!=this.modelValue&&this.modelValue.toString().length>0},ptmParams:function(){return{context:{filled:this.filled,disabled:this.$attrs.disabled||""===this.$attrs.disabled}}}}},l=["readonly","aria-invalid"];h.render=function(t,e,i,h,r,o){return s(),n("input",a({class:t.cx("root"),readonly:t.readonly,"aria-invalid":t.invalid||void 0,onInput:e[0]||(e[0]=function(){return o.onInput&&o.onInput.apply(o,arguments)}),onFocus:e[1]||(e[1]=function(){return o.onFocus&&o.onFocus.apply(o,arguments)}),onBlur:e[2]||(e[2]=function(){return o.onBlur&&o.onBlur.apply(o,arguments)}),onKeydown:e[3]||(e[3]=function(){return o.onKeyDown&&o.onKeyDown.apply(o,arguments)}),onKeypress:e[4]||(e[4]=function(){return o.onKeyPress&&o.onKeyPress.apply(o,arguments)}),onPaste:e[5]||(e[5]=function(){return o.onPaste&&o.onPaste.apply(o,arguments)})},t.ptmi("root",o.ptmParams)),null,16,l)};export{h as default};
